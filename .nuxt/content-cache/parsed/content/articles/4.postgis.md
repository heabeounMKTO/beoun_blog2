{"parsed":{"_path":"/articles/postgis","_dir":"articles","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"nearby places search with PostGIS plugin for PostgreSQL","description":"For this demo we will learn how to find the distance from a given longitude/latitude coordinates\nto another longitude/latitude tagged place of our interest.","cover":"portrait1.jpeg","author":{"name":"heabeoun"},"date":"2023-6-1","layout":"article","badges":[{"color":"white","bg":"rgba(0, 0, 0, 0.3)","content":"postgresql"},{"color":"white","bg":"rgba(0, 0, 0, 0.3)","content":"postgis"}],"body":{"type":"root","children":[{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For this demo we will learn how to find the distance from a given longitude/latitude coordinates\nto another longitude/latitude tagged place of our interest."}]},{"type":"element","tag":"h2","props":{"id":"installing-required-thingies"},"children":[{"type":"text","value":"Installing required thingies:"}]},{"type":"element","tag":"h3","props":{"id":"postgresql"},"children":[{"type":"text","value":"PostgreSQL"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"there are many tutorials out there :>"}]}]},{"type":"element","tag":"h3","props":{"id":"postgis"},"children":[{"type":"text","value":"PostGIS"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"you can follow the tutorial on how to install for your system "},{"type":"element","tag":"a","props":{"href":"https://postgis.net/documentation/getting_started/","rel":["nofollow"]},"children":[{"type":"text","value":"here"}]},{"type":"text","value":"\nafter you're done installing PostGIS , Create a database and then activate PostGIS for your database:\n"},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"connect to your database using psql or pgAdmin"}]},{"type":"text","value":" then run:"}]},{"type":"element","tag":"code","props":{"className":["language-sql"],"code":"CREATE EXTENSION postgis; \n-- the postgis extension\nCREATE EXTENSION hstore; \n-- hstore extension for storing unstructured data types\n","language":"sql","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"CREATE"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" EXTENSION postgis; \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"-- the postgis extension\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"CREATE"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" EXTENSION hstore; \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"-- hstore extension for storing unstructured data types"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"optional"}]}]},{"type":"text","value":"\nbecause we are going to import osm data for this tutorial , we will be using a tool called "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"osm2pgsql"}]},{"type":"text","value":"\nto install it simply run:"}]},{"type":"element","tag":"code","props":{"className":["language-shell"],"code":"apt install osm2pgsql\n","language":"shell","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"apt"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"install"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"osm2pgsql"}]}]}]}]}]},{"type":"element","tag":"h3","props":{"id":"getting-data"},"children":[{"type":"text","value":"Getting data"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"we will be importing data from "},{"type":"element","tag":"a","props":{"href":"https://www.openstreetmap.org","rel":["nofollow"]},"children":[{"type":"text","value":"OpenStreetMap"}]},{"type":"text","value":", then you can get export data from you location of choice by simply clicking \"export\" on the top left and then you will see a bar then press the blue \"export\" button again it will download a file called \"map.osm\" , then to import osm data into your database"}]},{"type":"element","tag":"code","props":{"className":["language-shell"],"code":"osm2pgsql -U admin -W -d osm -H yourhostname -P yourportnumber --hstore --hstore-add-index map.osm  \n","language":"shell","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-762058"},"children":[{"type":"text","value":"osm2pgsql"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-617022"},"children":[{"type":"text","value":"-U"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"admin"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-617022"},"children":[{"type":"text","value":"-W"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-617022"},"children":[{"type":"text","value":"-d"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"osm"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-617022"},"children":[{"type":"text","value":"-H"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"yourhostname"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-617022"},"children":[{"type":"text","value":"-P"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"yourportnumber"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-617022"},"children":[{"type":"text","value":"--hstore"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-617022"},"children":[{"type":"text","value":"--hstore-add-index"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"map.osm"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"  "}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Start out with the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"osm2pgsql"}]},{"type":"text","value":" command and add "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"-U"}]},{"type":"text","value":" with your database username (usually "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"admin"}]},{"type":"text","value":") and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"-W"}]},{"type":"text","value":" indicating that you need a password prompt. Next, add "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"-d"}]},{"type":"text","value":" and your database name (here "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"osm"}]},{"type":"text","value":"). The "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"-H"}]},{"type":"text","value":" option is the deployment's hostname and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"-P"}]},{"type":"text","value":" is the port number. We've added the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"--hstore"}]},{"type":"text","value":" to create "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"tags"}]},{"type":"text","value":" columns for each table that contains the supplemental non-standardized data and the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"--hstore-add-index"}]},{"type":"text","value":" option sets up indexes on those columns. Finally, we add the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"map.osm"}]},{"type":"text","value":" file that we downloaded. Now your database should have four tables (excluding : "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"spatial_ref_sys"}]},{"type":"text","value":" as PostGIS requires this table to work)"}]},{"type":"element","tag":"h2","props":{"id":"the-fun-part"},"children":[{"type":"text","value":"The fun part"}]},{"type":"element","tag":"h3","props":{"id":"_1-getting-standard-longitudelatitude-coordinates-from-our-imported-osm-data"},"children":[{"type":"text","value":"1.  "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"Getting standard longitude/latitude coordinates from our imported osm data:"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In our imported osm data there are 4 tables in total, Since we want to get the distance from our location to a place of our interest in standard longitude/latitude format, We will be using the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"planet_osm_points"}]},{"type":"text","value":" since that table stores landmarks. Now to get the coordinates of locations labeled as "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"amenity"}]},{"type":"text","value":" we can run :"}]},{"type":"element","tag":"code","props":{"className":["language-sql"],"code":"SELECT ST_X(ST_AsText(ST_Transform(way, 4326))) as longitude\n,ST_Y(ST_AsText(ST_Transform(way, 4326))) as latitude, \namenity,name \nFROM planet_osm_point WHERE amenity IS NOT NULL;\n","language":"sql","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"SELECT"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" ST_X(ST_AsText(ST_Transform(way, "}]},{"type":"element","tag":"span","props":{"class":"ct-617022"},"children":[{"type":"text","value":"4326"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"))) "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"as"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" longitude\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":",ST_Y(ST_AsText(ST_Transform(way, "}]},{"type":"element","tag":"span","props":{"class":"ct-617022"},"children":[{"type":"text","value":"4326"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"))) "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"as"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" latitude, \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"amenity,"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"FROM"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" planet_osm_point "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"WHERE"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" amenity "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"IS NOT NULL"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":";"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"it will output:"}]},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{"align":null},"children":[{"type":"text","value":"longitude"}]},{"type":"element","tag":"th","props":{"align":null},"children":[{"type":"text","value":"latitude"}]},{"type":"element","tag":"th","props":{"align":null},"children":[{"type":"text","value":"amenity"}]},{"type":"element","tag":"th","props":{"align":null},"children":[{"type":"text","value":"name"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"104.92080459999998"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"11.556113299541718"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"atm"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"ANZ Royal ATM"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"104.92778869999998"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"11.553392399541488"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"restaurant"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Il Forno"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"now,  what makes PostGIS special is it's built in functions, We will go through the functions together. First , in our select command is "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ST_Transform"}]},{"type":"text","value":", Since the column "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"way"}]},{"type":"text","value":" is stored in PostGIS's  "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"geometry"}]},{"type":"text","value":" datatype, which is just computer gibberish. In order for it to make sense to us we need to convert it to a human readable format , or at least a human readable spatial reference system, which in our case we want it to be in "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"WGS84"}]},{"type":"text","value":"  which has a number of 4326 in the "},{"type":"element","tag":"a","props":{"href":"https://en.wikipedia.org/wiki/EPSG_Geodetic_Parameter_Dataset","rel":["nofollow"]},"children":[{"type":"text","value":"ESPG"}]},{"type":"text","value":" identifier "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"( WGS84 is a standard coordinate frame for the Earth, a datum/reference ellipsoid for raw altitude data. WGS84 and ESPG is out of the scope of discussion for this article )"}]},{"type":"text","value":" , then we want to convert the geometry format into plain text therefore we wrap it in "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ST_AsText"}]},{"type":"text","value":", so currently if we run"}]},{"type":"element","tag":"code","props":{"className":["language-sql"],"code":"SELECT ST_AsText(ST_Transform(way, 4326)) \nFROM planet_osm_point WHERE amenity IS NOT NULL;\n","language":"sql","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"SELECT"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" ST_AsText(ST_Transform(way, "}]},{"type":"element","tag":"span","props":{"class":"ct-617022"},"children":[{"type":"text","value":"4326"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":")) \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"FROM"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" planet_osm_point "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"WHERE"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" amenity "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"IS NOT NULL"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":";"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"we get"}]},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{"align":null},"children":[{"type":"text","value":"st_astext"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"\"POINT(104.92080459999998 11.556113299541718)\""}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"\"POINT(104.92778869999998 11.553392399541488)\""}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"...."}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"it is in PostGIS's point format so, this is where "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ST_X"}]},{"type":"text","value":" and "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ST_Y"}]},{"type":"text","value":" comes in, as it is a handy function to map the Points to longitude and latitude according to the X and Y respectively, so the final result is like at the top."}]},{"type":"element","tag":"h3","props":{"id":"_2-getting-the-distance-from-a-given-latlong-to-another-latlong"},"children":[{"type":"text","value":"2. Getting the distance from a given lat/long to another lat/long"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"it is very easy to get the distance from one point to another by using "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ST_Distance"}]},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"for instance:"}]}]},{"type":"element","tag":"code","props":{"className":["language-sql"],"code":"SELECT ST_Distance(\n    'SRID=4326;POINT(104.92080459999998 11.556113299541718)'::geography,\n    'SRID=4326;POINT(104.9259047 11.556225899541724)'::geography\n);\n","language":"sql","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"SELECT"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" ST_Distance(\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"'SRID=4326;POINT(104.92080459999998 11.556113299541718)'"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"geography"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"'SRID=4326;POINT(104.9259047 11.556225899541724)'"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"geography\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":");"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"we will get:"}]},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{"align":null},"children":[{"type":"text","value":"st_distance"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"556.44590038"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"now, you can read about what is the "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"geography"}]},{"type":"text","value":" thingy "},{"type":"element","tag":"a","props":{"href":"http://postgis.net/workshops/postgis-intro/geography.html","rel":["nofollow"]},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"here"}]}]},{"type":"text","value":", in the mean time our distance between the points are "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"556.44590038"}]},{"type":"text","value":" , this number is in meters. "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"very easy !"}]}]},{"type":"element","tag":"h3","props":{"id":"_3-putting-it-all-together"},"children":[{"type":"text","value":"3. Putting it all together"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"If we put the two things we learned at the top together we can get query for the nearest location within a , let's say 2km radius"}]},{"type":"element","tag":"code","props":{"className":["language-sql"],"code":"SELECT \nST_Distance(\n    'SRID=4326;POINT(104.92379749999999 11.535633599540022)'::geography,\n    ST_AsEWKT(ST_Transform(way, 4326))::geography\n) AS distance,\n name, amenity \n FROM planet_osm_point \n WHERE amenity = 'fast_food' \n AND ST_Distance(\n    'SRID=4326;POINT(104.92379749999999 11.535633599540022)'::geography,\n    ST_AsEWKT(ST_Transform(way, 4326))::geography\n) <= 2000; --this is the radius \n","language":"sql","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"SELECT"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"ST_Distance(\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"'SRID=4326;POINT(104.92379749999999 11.535633599540022)'"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"geography"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    ST_AsEWKT(ST_Transform(way, "}]},{"type":"element","tag":"span","props":{"class":"ct-617022"},"children":[{"type":"text","value":"4326"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"))::"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"geography\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"AS"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" distance,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":", amenity \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"FROM"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" planet_osm_point \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"WHERE"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" amenity "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"'fast_food'"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"AND"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" ST_Distance(\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"'SRID=4326;POINT(104.92379749999999 11.535633599540022)'"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"geography"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    ST_AsEWKT(ST_Transform(way, "}]},{"type":"element","tag":"span","props":{"class":"ct-617022"},"children":[{"type":"text","value":"4326"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"))::"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"geography\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"<="}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-617022"},"children":[{"type":"text","value":"2000"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"; "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"--this is the radius "}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"note: "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ST_AsEWKT"}]},{"type":"text","value":" is just "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ST_AsText"}]},{"type":"text","value":" with the SRID included in the text so it is easier for us to cast it as a geography type when we run \t"},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ST_Distance"}]}]},{"type":"text","value":"\nit will output:"}]},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{"align":null},"children":[{"type":"text","value":"distance"}]},{"type":"element","tag":"th","props":{"align":null},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"th","props":{"align":null},"children":[{"type":"text","value":"amenity"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"1958.01669185"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"Krispy Kreme"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"fast_food"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"1850.08767635"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"null"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"fast_food"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"note : the distance is in "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"meters"}]},{"type":"text","value":"."}]},{"type":"element","tag":"td","props":{"align":null},"children":[]},{"type":"element","tag":"td","props":{"align":null},"children":[]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"but wait, there "},{"type":"element","tag":"em","props":{},"children":[{"type":"text","value":"is"}]},{"type":"text","value":" also another built in PostGIS just to find points in a radius called "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"ST_DWithin"}]},{"type":"text","value":" so , we can revise our sql command to:"}]},{"type":"element","tag":"code","props":{"className":["language-sql"],"code":"SELECT \nST_Distance(\n    'SRID=4326;POINT(104.92379749999999 11.535633599540022)'::geography,\n    ST_AsEWKT(ST_Transform(way, 4326))::geography\n) AS distance,\n name, amenity \n FROM planet_osm_point \n WHERE ST_DWithin('SRID=4326;POINT(104.92379749999999 11.535633599540022)'::geography,\n                 ST_AsEWKT(ST_Transform(way, 4326))::geography, 2000 --this is the radius\n                 ) AND amenity IS NOT NULL;\n","language":"sql","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"SELECT"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"ST_Distance(\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"'SRID=4326;POINT(104.92379749999999 11.535633599540022)'"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"geography"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"    ST_AsEWKT(ST_Transform(way, "}]},{"type":"element","tag":"span","props":{"class":"ct-617022"},"children":[{"type":"text","value":"4326"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"))::"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"geography\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"AS"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" distance,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"name"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":", amenity \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"FROM"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" planet_osm_point \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"WHERE"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" ST_DWithin("}]},{"type":"element","tag":"span","props":{"class":"ct-952708"},"children":[{"type":"text","value":"'SRID=4326;POINT(104.92379749999999 11.535633599540022)'"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"::"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"geography"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"                 ST_AsEWKT(ST_Transform(way, "}]},{"type":"element","tag":"span","props":{"class":"ct-617022"},"children":[{"type":"text","value":"4326"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"))::"}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"geography"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-617022"},"children":[{"type":"text","value":"2000"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-086898"},"children":[{"type":"text","value":"--this is the radius\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":"                 ) "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"AND"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":" amenity "}]},{"type":"element","tag":"span","props":{"class":"ct-149352"},"children":[{"type":"text","value":"IS NOT NULL"}]},{"type":"element","tag":"span","props":{"class":"ct-553616"},"children":[{"type":"text","value":";"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"building-our-own-partner-locations-finder"},"children":[{"type":"text","value":"Building our own partner locations finder"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"With what we learned above we can build our very own table in PostgreSQL to find our bussiness partners within a given radius, we only need to fit it to our own use case therefore making our own table, which would look something like:"}]},{"type":"element","tag":"table","props":{},"children":[{"type":"element","tag":"thead","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"th","props":{"align":null},"children":[{"type":"text","value":"id "},{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"PK"}]}]},{"type":"element","tag":"th","props":{"align":null},"children":[{"type":"text","value":"site (varchar)"}]},{"type":"element","tag":"th","props":{"align":null},"children":[{"type":"text","value":"longlat(geography)"}]},{"type":"element","tag":"th","props":{"align":null},"children":[{"type":"text","value":"type(varchar)"}]}]}]},{"type":"element","tag":"tbody","props":{},"children":[{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"3124"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"beoun.net"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"SRID=4326;POINT(104.92379749999999 11.535633599540022)"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"shop"}]}]},{"type":"element","tag":"tr","props":{},"children":[{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"4232"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"goofyahh.bar"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"SRID=4326;POINT(104.92379749999999 11.535633599540022)"}]},{"type":"element","tag":"td","props":{"align":null},"children":[{"type":"text","value":"bar"}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"more-reading-if-you-are-interested-in-diving-into-this"},"children":[{"type":"text","value":"More reading, if you are interested in diving into this"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://postgis.net/workshops/postgis-intro/","rel":["nofollow"]},"children":[{"type":"text","value":"Postgis tutorial/demo"}]},{"type":"text","value":" "},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"a","props":{"href":"https://en.wikipedia.org/wiki/World_Geodetic_System","rel":["nofollow"]},"children":[{"type":"text","value":"World Geodetic System, aka what that WGS84 thingy means"}]},{"type":"text","value":" "},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"a","props":{"href":"http://postgis.net/workshops/postgis-intro/spatial_relationships.html","rel":["nofollow"]},"children":[{"type":"text","value":"Postgis spatial relationships"}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-149352{color:#D73A49;}\n.dark .ct-149352{color:#F97583;}\n.ct-553616{color:#24292E;}\n.dark .ct-553616{color:#E1E4E8;}\n.ct-086898{color:#6A737D;}\n.ct-762058{color:#6F42C1;}\n.dark .ct-762058{color:#B392F0;}\n.ct-952708{color:#032F62;}\n.dark .ct-952708{color:#9ECBFF;}\n.ct-617022{color:#005CC5;}\n.dark .ct-617022{color:#79B8FF;}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"installing-required-thingies","depth":2,"text":"Installing required thingies:","children":[{"id":"postgresql","depth":3,"text":"PostgreSQL"},{"id":"postgis","depth":3,"text":"PostGIS"},{"id":"getting-data","depth":3,"text":"Getting data"}]},{"id":"the-fun-part","depth":2,"text":"The fun part","children":[{"id":"_1-getting-standard-longitudelatitude-coordinates-from-our-imported-osm-data","depth":3,"text":"1.  Getting standard longitude/latitude coordinates from our imported osm data:"},{"id":"_2-getting-the-distance-from-a-given-latlong-to-another-latlong","depth":3,"text":"2. Getting the distance from a given lat/long to another lat/long"},{"id":"_3-putting-it-all-together","depth":3,"text":"3. Putting it all together"}]},{"id":"building-our-own-partner-locations-finder","depth":2,"text":"Building our own partner locations finder"},{"id":"more-reading-if-you-are-interested-in-diving-into-this","depth":2,"text":"More reading, if you are interested in diving into this"}]}},"_type":"markdown","_id":"content:articles:4.postgis.md","_source":"content","_file":"articles/4.postgis.md","_extension":"md"},"hash":"TEsdcCbldc"}